<div id="<%= dom_id(card) %>" class="card<%= " archived" if card.archived? %>">
  <div class="card-action">
    <% if card.cardable.completable? %>
      <% if card.cardable.done? %>
        <%= button_to card_completion_path(card), method: :delete, class: "completion-toggle done", aria: { label: "Mark undone" } do %>
          &#10003;
        <% end %>
      <% else %>
        <%= button_to card_completion_path(card), method: :post, class: "completion-toggle", aria: { label: "Mark done" } do %>
          &#9675;
        <% end %>
      <% end %>
    <% end %>
    <%= render partial: "#{card.cardable_type.underscore.pluralize}/#{card.cardable_type.underscore}", locals: { card: card } %>
  </div>
  <a class="card-body"
     href="<%= card_path(card) %>"
     data-turbo-frame="modal"
     data-turbo-action="advance"
     data-action="dialog#open">
    <div class="card-meta">
      <span class="card-type"><%= card.cardable_type %></span>
    </div>
    <p class="card-title<%= " done" if card.cardable.completable? && card.cardable.done? %>">
      <%= card.title %>
    </p>
    <% if card.tags.any? %>
      <div class="card-tags">
        <% card.tags.each do |tag| %>
          <span class="tag-chip"><%= tag.name %></span>
        <% end %>
      </div>
    <% end %>
  </a>
  <div class="card-menu">
    <button class="card-menu-trigger"
            popovertarget="card-menu-<%= card.id %>"
            style="anchor-name: --card-menu-<%= card.id %>">â‹¯</button>
    <div id="card-menu-<%= card.id %>"
         class="card-dropdown-menu"
         popover
         style="position-anchor: --card-menu-<%= card.id %>">
      <%= button_to card.pops_on.present? ? "Dismiss" : "Pop",
                    card_pop_path(card),
                    method: :patch,
                    class: "card-dropdown-item" %>
      <%= button_to card.pinned? ? "Unpin" : "Pin",
                    card_pin_path(card),
                    method: :patch,
                    class: "card-dropdown-item" %>
      <%= link_to "Edit",
                   edit_card_path(card),
                   data: { turbo_frame: "modal", turbo_action: "advance", action: "dialog#open" },
                   class: "card-dropdown-item" %>
      <%= button_to card.archived? ? "Unarchive" : "Archive",
                    card_archive_path(card),
                    method: :patch,
                    class: "card-dropdown-item" %>
      <%= button_to "Delete",
                    card_path(card),
                    method: :delete,
                    class: "card-dropdown-item card-dropdown-item--danger",
                    form: { data: { turbo_confirm: "Are you sure?" } } %>
    </div>
  </div>
</div>
